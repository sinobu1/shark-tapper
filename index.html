<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Shark Tapper Fusion Final</title>
<script src="https://telegram.org/js/telegram-web-app.js">
function toggleTheme() {
  const body = document.body;
  const current = body.classList.contains("dark-theme") ? "dark" : "light";
  const next = current === "dark" ? "light" : "dark";
  body.classList.remove(current + "-theme");
  body.classList.add(next + "-theme");
  localStorage.setItem("theme", next);
  document.getElementById("themeToggle").textContent = next === "dark" ? "‚òÄÔ∏è" : "üåô";
}

(function applyStoredTheme() {
  const stored = localStorage.getItem("theme") || "light";
  document.body.classList.add(stored + "-theme");
  const icon = stored === "dark" ? "‚òÄÔ∏è" : "üåô";
  window.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("themeToggle");
    if (btn) btn.textContent = icon;
  });
})();


function triggerVibration(ms = 30) {
  try {
    if (Telegram && Telegram.WebApp && Telegram.WebApp.HapticFeedback) {
      Telegram.WebApp.HapticFeedback.impactOccurred('light');
    }
    if (navigator.vibrate) navigator.vibrate(ms);
  try {
    if (window.navigator && navigator.vibrate) {
      navigator.vibrate(ms);
    } else if (Telegram && Telegram.WebApp && Telegram.WebApp.HapticFeedback) {
      Telegram.WebApp.HapticFeedback.impactOccurred('light');
    }
  } catch (e) {
    console.warn("Vibration failed:", e);
  }
}

</script>
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
  overflow: hidden;
  height: 100vh;
}
body {
      font-family: 'SF Pro Display', sans-serif;
      background: linear-gradient(160deg, #e3f2fd, #e0f7fa);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 10px;
    }
    .tab-panel {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(255,255,255,0.9);
  padding: 6px 8px;
  box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
  z-index: 1000;
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      margin: 10px auto;
      width: 100%;
      max-width: 500px;
      gap: 4px;
    }
    .tab-button {
  background: linear-gradient(145deg, #00bfa5, #00c8a8);
  border-radius: 12px;
  margin: 0 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);

      flex: 1;
      padding: 8px 0;
      font-size: 14px;
      border-radius: 0;
      border: none;
      background: #00bfa5;
      color: white;
      font-weight: 600;
      transition: background 0.2s;
    }
    .tab-button:hover {
      background: #009e85;
    }
    .tab-button:active {
      transform: scale(0.98);
    }
    .game-container {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
      margin-top: 20px;
    }
    .tap-image {
      width: 45vw;
      max-width: 300px;
      border-radius: 16px;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .tap-animation {
      animation: tapPulse 0.2s ease;
    }
    @keyframes tapPulse {
      0% { transform: scale(1); }
      50% { transform: scale(0.9); }
      100% { transform: scale(1); }
    }
  
html, body {
  overflow: hidden;
  height: 100vh;
}
body {
  transition: background-color 0.4s ease, color 0.4s ease;
}
.light-theme {
  background: linear-gradient(160deg, #e3f2fd, #e0f7fa);
  color: #000;
}
.dark-theme {
  background: linear-gradient(160deg, #121212, #1e1e1e);
  color: #fff;
}
.tab-button {
  background: linear-gradient(145deg, #00bfa5, #00c8a8);
  border-radius: 12px;
  margin: 0 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);

  transition: background 0.3s ease;
}
.dark-theme .tab-button {
  background: linear-gradient(145deg, #00bfa5, #00c8a8);
  border-radius: 12px;
  margin: 0 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);

  background: #333;
  color: #fff;
}
.light-theme .tab-button {
  background: linear-gradient(145deg, #00bfa5, #00c8a8);
  border-radius: 12px;
  margin: 0 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);

  background: #00bfa5;
  color: white;
}



/* Telegram-style UI */
body {
  background-color: #0d0d0d;
  color: #eee;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

button, .button {
  background: linear-gradient(135deg, #8e44ad, #2980b9);
  color: white;
  border: none;
  padding: 12px 18px;
  border-radius: 14px;
  font-size: 16px;
  font-weight: 600;
  transition: background 0.3s ease, transform 0.1s ease;
}
button:active, .button:active {
  transform: scale(0.96);
  opacity: 0.9;
}

.footer {
  position: fixed;
  bottom: 0;
  left: 0; right: 0;
  display: flex;
  justify-content: space-around;
  background: rgba(20, 20, 20, 0.85);
  backdrop-filter: blur(10px);
  padding: 10px 0;
  z-index: 100;
}

.header {
  position: fixed;
  top: 0;
  left: 0; right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 16px;
  background: rgba(20, 20, 20, 0.9);
  backdrop-filter: blur(8px);
  z-index: 100;
}

#themeToggle {
  font-size: 22px;
  background: none;
  border: none;
  cursor: pointer;
  color: white;
}
</style>
</head>
<body>
<div style="position: absolute; top: 10px; right: 12px; z-index: 1001;">
<button id="themeToggle" onclick="toggleTheme()" style="font-size: 22px; background: none; border: none; cursor: pointer;">üåó</button>
</div>
<div class="tab-panel">
<button class="tab-button" onclick="toggleTab('gameContainer')">ü¶à –ò–≥—Ä–∞</button>
<button class="tab-button" onclick="toggleTab('boosterContainer')">‚ö° –ë—É—Å—Ç–µ—Ä—ã</button>
<button class="tab-button" onclick="toggleTab('shopContainer')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
<button class="tab-button" onclick="toggleTab('profileContainer')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
<button class="tab-button" onclick="openLeaderboard()">üèÜ –¢–æ–ø</button>
</div>
<div class="balance" id="tokenCount">0 tokens</div>
<div class="game-container" id="gameContainer">
<img alt="Shark" class="tap-image" id="tapImage" onclick="handleTap()" src="shark.png"/>
</div>
<div class="game-container" id="boosterContainer">
<h2>Boosters</h2>
<button onclick="buyBooster(50, 1)">Auto-Tap +1 (50)</button>
<button onclick="buyBooster(100, 2)">Auto-Tap +2 (100)</button>
<button onclick="buyBooster(1000, 3)">Auto-Tap +3 (1000)</button>
</div>
<div class="game-container" id="shopContainer">
<h2>Skins</h2>
<button onclick="buySkin('default', 0)">Default (Free)</button>
<button onclick="buySkin('gold', 1000)">Gold (1000)</button>
<button onclick="buySkin('leopard', 500)">Leopard (500)</button>
</div>
<div class="game-container" id="profileContainer">
<h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
<img alt="avatar" id="profileAvatar" src="" style="width:72px;height:72px;border-radius:50%;margin:10px 0;"/>
<h3 id="profileName">–ò–≥—Ä–æ–∫</h3>
<p id="profileTokens">–¢–æ–∫–µ–Ω–æ–≤: 0</p>
<p id="profileLevel">–£—Ä–æ–≤–µ–Ω—å: 1</p>
<p id="profileJoin">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ‚Äî</p>
</div>
<div id="leaderboard-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.95);z-index:1000;flex-direction:column;align-items:center;justify-content:center;">
<h2>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
<ul id="leaderboardList"></ul>
<button onclick="document.getElementById('leaderboard-modal').style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
<script>
const dbUrl = "https://tralalero-fec07-default-rtdb.firebaseio.com";
let userId = null;
let balance = 0, autoTap = 0, level = 1, xp = 0;
let ownedSkins = { default: true };
let currentSkin = 'default';
let userFirstName = '', userAvatar = '', joinDate = '';

const tokenCount = document.getElementById("tokenCount");
const tapImage = document.getElementById("tapImage");

function updateBalanceDisplay() {
  tokenCount.textContent = `${balance} tokens`;
  document.getElementById("profileTokens").textContent = `–¢–æ–∫–µ–Ω–æ–≤: ${balance}`;
}

function updateProfileInfo() {
  document.getElementById("profileName").textContent = userFirstName;
  document.getElementById("profileAvatar").src = userAvatar;
  document.getElementById("profileJoin").textContent = `–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${joinDate}`;
  document.getElementById("profileLevel").textContent = `–£—Ä–æ–≤–µ–Ω—å: ${level}`;
}

function handleTap() {
  balance++;
  updateBalanceDisplay();
  tapImage.classList.add("tap-animation");
  setTimeout(() => tapImage.classList.remove("tap-animation"), 200);
  if (navigator.vibrate) triggerVibration(30);
  saveProgress();
}

function saveProgress() {
  if (!userId) return;
  fetch(`${dbUrl}/users/${userId}.json`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ balance, currentSkin, first_name: userFirstName, photo_url: userAvatar, joinDate })
  });
}

function loadProgress() {
  if (!userId) return;
  fetch(`${dbUrl}/users/${userId}.json`)
    .then(res => res.json())
    .then(data => {
      if (data) {
        balance = data.balance || 0;
        currentSkin = data.currentSkin || 'default';
        userFirstName = data.first_name || '–ò–≥—Ä–æ–∫';
        userAvatar = data.photo_url || '';
        joinDate = data.joinDate || new Date().toISOString().split('T')[0];
        updateBalanceDisplay();
        updateSkin(currentSkin);
        updateProfileInfo();
      }
    });
}

function toggleTab(id) {
  ['gameContainer', 'shopContainer', 'boosterContainer', 'profileContainer'].forEach(el => {
    const element = document.getElementById(el);
    if (element) element.style.display = 'none';
  });
  const selected = document.getElementById(id);
  if (selected) selected.style.display = 'flex';
}

function buyBooster(cost, power) {
  if (balance >= cost) {
    balance -= cost;
    autoTap += power;
    updateBalanceDisplay();
    saveProgress();
  }
}

function buySkin(skin, cost) {
  if (ownedSkins[skin] || balance >= cost) {
    if (!ownedSkins[skin]) {
      balance -= cost;
      ownedSkins[skin] = true;
    }
    currentSkin = skin;
    updateSkin(skin);
    updateBalanceDisplay();
    saveProgress();
  }
}

function updateSkin(skin) {
  if (skin === 'gold') tapImage.src = 'shark_skin1.png';
  else if (skin === 'leopard') tapImage.src = 'shark_skin2.png';
  else tapImage.src = 'shark.png';
}

function openLeaderboard() {
  document.getElementById('leaderboard-modal').style.display = 'flex';
  fetch(`${dbUrl}/users.json`)
    .then(res => res.json())
    .then(data => {
      const leaderboard = document.getElementById('leaderboardList');
      leaderboard.innerHTML = '';
      const users = Object.entries(data || {}).map(([id, info]) => ({ id, ...info }))
        .sort((a, b) => b.balance - a.balance).slice(0, 10);
      users.forEach(user => {
        const name = user.first_name || `ID ${user.id.slice(-4)}`;
        const avatar = user.photo_url ? `<img src="${user.photo_url}" style="width:20px;height:20px;border-radius:50%;margin-right:6px;" />` : '';
        const li = document.createElement('li');
        li.innerHTML = `${avatar}<strong>${name}</strong>: ${user.balance}`;
        leaderboard.appendChild(li);
      });
    });
}

setInterval(() => {
  if (autoTap > 0) {
    balance += autoTap;
    updateBalanceDisplay();
    saveProgress();
  }
}, 1000);

window.onload = () => {
  if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
    const user = Telegram.WebApp.initDataUnsafe?.user || {};
    userId = user?.id?.toString();
    userFirstName = user?.first_name || user?.username || '–ò–≥—Ä–æ–∫';
    userAvatar = user?.photo_url || (user?.username ? `https://t.me/i/userpic/320/${user.username}.jpg` : 'https://via.placeholder.com/72');
    joinDate = new Date().toISOString().split('T')[0];
    if (userId) loadProgress();
  }
  toggleTab('gameContainer');
};

function toggleTheme() {
  const body = document.body;
  const current = body.classList.contains("dark-theme") ? "dark" : "light";
  const next = current === "dark" ? "light" : "dark";
  body.classList.remove(current + "-theme");
  body.classList.add(next + "-theme");
  localStorage.setItem("theme", next);
  document.getElementById("themeToggle").textContent = next === "dark" ? "‚òÄÔ∏è" : "üåô";
}

(function applyStoredTheme() {
  const stored = localStorage.getItem("theme") || "light";
  document.body.classList.add(stored + "-theme");
  const icon = stored === "dark" ? "‚òÄÔ∏è" : "üåô";
  window.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("themeToggle");
    if (btn) btn.textContent = icon;
  });
})();


function triggerVibration(ms = 30) {
  try {
    if (Telegram && Telegram.WebApp && Telegram.WebApp.HapticFeedback) {
      Telegram.WebApp.HapticFeedback.impactOccurred('light');
    }
    if (navigator.vibrate) navigator.vibrate(ms);
  try {
    if (window.navigator && navigator.vibrate) {
      navigator.vibrate(ms);
    } else if (Telegram && Telegram.WebApp && Telegram.WebApp.HapticFeedback) {
      Telegram.WebApp.HapticFeedback.impactOccurred('light');
    }
  } catch (e) {
    console.warn("Vibration failed:", e);
  }
}

</script>
<script>
let userId = null;
let balance = 0;
let currentSkin = 'default';
let userFirstName = '–ò–≥—Ä–æ–∫';
let userAvatar = '';
let joinDate = '';
const dbUrl = "https://tralalero-fec07-default-rtdb.firebaseio.com";

function updateBalanceDisplay() {
  const el = document.getElementById("tokenCount");
  if (el) el.textContent = balance + " tokens";
  const profile = document.getElementById("profileTokens");
  if (profile) profile.textContent = "–¢–æ–∫–µ–Ω–æ–≤: " + balance;
}

function updateSkin(skin) {
  const tapImage = document.getElementById("tapImage");
  if (!tapImage) return;
  if (skin === 'gold') tapImage.src = 'shark_skin1.png';
  else if (skin === 'leopard') tapImage.src = 'shark_skin2.png';
  else tapImage.src = 'shark.png';
}

function toggleTab(id) {
  ['gameContainer', 'shopContainer', 'boosterContainer', 'profileContainer'].forEach(el => {
    const e = document.getElementById(el);
    if (e) e.style.display = 'none';
  });
  const active = document.getElementById(id);
  if (active) active.style.display = 'flex';
}

function toggleTheme() {
  const body = document.body;
  const isDark = body.classList.contains("dark-theme");
  body.classList.toggle("dark-theme", !isDark);
  body.classList.toggle("light-theme", isDark);
  localStorage.setItem("theme", isDark ? "light" : "dark");
  const themeBtn = document.getElementById("themeToggle");
  if (themeBtn) themeBtn.textContent = isDark ? "üåó" : "üåû";
}

function handleTap() {
  const tapImage = document.getElementById("tapImage");
  balance++;
  updateBalanceDisplay();
  if (tapImage) {
    tapImage.classList.add("tap-animation");
    setTimeout(() => tapImage.classList.remove("tap-animation"), 200);
  }
  try {
    if (Telegram?.WebApp?.HapticFeedback) {
      Telegram.WebApp.HapticFeedback.impactOccurred("light");
    }
    if (navigator.vibrate) navigator.vibrate(30);
  } catch(e) {}
  saveProgress();
}

function saveProgress() {
  if (!userId) return;
  fetch(`${dbUrl}/users/${userId}.json`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ balance, currentSkin, first_name: userFirstName, photo_url: userAvatar, joinDate })
  });
}

function loadProgress() {
  if (!userId) return;
  fetch(`${dbUrl}/users/${userId}.json`)
    .then(r => r.json())
    .then(data => {
      if (data) {
        balance = data.balance || 0;
        currentSkin = data.currentSkin || 'default';
        userFirstName = data.first_name || userFirstName;
        userAvatar = data.photo_url || userAvatar;
        joinDate = data.joinDate || joinDate;
        updateBalanceDisplay();
        updateSkin(currentSkin);
        updateProfileInfo();
      }
    });
}

function updateProfileInfo() {
  const pName = document.getElementById("profileName");
  const pAvatar = document.getElementById("profileAvatar");
  const pJoin = document.getElementById("profileJoin");
  if (pName) pName.textContent = userFirstName;
  if (pAvatar) pAvatar.src = userAvatar;
  if (pJoin) pJoin.textContent = "–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: " + joinDate;
}

function openLeaderboard() {
  const modal = document.getElementById("leaderboard-modal");
  if (modal) modal.style.display = "flex";
  fetch(`${dbUrl}/users.json`)
    .then(r => r.json())
    .then(data => {
      const list = document.getElementById("leaderboardList");
      if (!list) return;
      list.innerHTML = "";
      const users = Object.entries(data || {}).map(([id, u]) => ({ id, ...u }))
        .sort((a, b) => b.balance - a.balance).slice(0, 10);
      users.forEach(user => {
        const name = user.first_name || "User";
        const photo = user.photo_url || "https://t.me/i/userpic/320/" + (user.username || "unknown") + ".jpg";
        const li = document.createElement("li");
        li.innerHTML = `<img src="${photo}" style="width:24px;height:24px;border-radius:50%;margin-right:6px;" /><strong>${name}</strong>: ${user.balance}`;
        list.appendChild(li);
      });
    });
}

window.addEventListener("DOMContentLoaded", () => {
  const theme = localStorage.getItem("theme") || "light";
  document.body.classList.add(theme + "-theme");
  const themeBtn = document.getElementById("themeToggle");
  if (themeBtn) themeBtn.textContent = theme === "dark" ? "üåó" : "üåû";

  toggleTab('gameContainer');
  updateBalanceDisplay();

  if (typeof Telegram !== "undefined" && Telegram.WebApp) {
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
    const user = Telegram.WebApp.initDataUnsafe?.user || {};
    userId = user.id?.toString();
    userFirstName = user.first_name || user.username || "–ò–≥—Ä–æ–∫";
    userAvatar = user.photo_url || (user.username ? `https://t.me/i/userpic/320/${user.username}.jpg` : "https://via.placeholder.com/72");
    joinDate = new Date().toISOString().split("T")[0];
    updateProfileInfo();
    loadProgress();
  }
});
</script></body>
</html>
