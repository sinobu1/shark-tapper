<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Shark Tapper</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=SF+Pro+Display:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      width: 100%; height: 100%; overflow: hidden;
      font-family: 'SF Pro Display', 'Segoe UI', sans-serif;
      background: linear-gradient(160deg, #f1f3f5, #dee2e6);
    }
    .loading-screen {
      position: fixed; width: 100%; height: 100%; background: #fff; z-index: 9999;
      display: flex; align-items: center; justify-content: center; flex-direction: column;
    }
    .game-container {
      display: none;
      position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
      width: 90vw; max-width: 400px; height: 90vh; max-height: 700px;
      background: white; border-radius: 24px; box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      padding: 20px; display: flex; flex-direction: column; justify-content: space-between; align-items: center;
    }
    .balance {
      font-size: 22px; font-weight: 600; color: #111;
    }
    .tap-image {
      max-width: 100%; border-radius: 16px; cursor: pointer;
      transition: transform 0.1s;
    }
    .tap-animation { animation: tapPulse 0.2s ease; }
    @keyframes tapPulse {
      0% { transform: scale(1); }
      50% { transform: scale(0.9); }
      100% { transform: scale(1); }
    }
    .floating-text {
      position: absolute; font-size: 24px; color: #00c853; font-weight: 700;
      animation: floatUp 1s ease-out forwards; pointer-events: none;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
    }
    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-50px); }
    }
    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-around;
      background: white;
      border-top: 1px solid #ccc;
      padding: 10px 0;
      z-index: 1000;
    }
    .tab-button {
      background: none;
      border: none;
      font-size: 18px;
      font-weight: 600;
      color: #444;
      font-family: 'SF Pro Display';
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="loading-screen" id="loading">
    <img src="w1.png" alt="Loading..." style="position:absolute; width:100%; height:100%; object-fit:cover; z-index:-1;">
    <div style="position:absolute; bottom:80px; width:100%; text-align:center;">
      <div style="font-family: 'Orbitron', sans-serif; font-size: 28px; color: #fff; text-shadow: 2px 2px 8px rgba(0,0,0,0.8); margin-bottom: 16px;">Adventure of the Year 2025</div>
      <div style="width: 80%; height: 14px; background: #1a1a1a; border-radius: 8px; overflow: hidden; margin: 0 auto;">
        <div id="progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #00ffcc, #0072ff); animation: loadProgress 5s linear forwards; box-shadow: 0 0 12px #00f5ff;"></div>
      </div>
    </div>
  </div>

  <div class="game-container" id="gameContainer">
    <div class="balance" id="tokenCount">0 tokens</div>
    <img src="shark.png" id="tapImage" class="tap-image" onclick="handleTap()" alt="Shark">
  </div>

  <div class="tab-bar">
    <button class="tab-button" onclick="alert('Game tab active')">ü¶à Game</button>
    <button class="tab-button" onclick="alert('Quests coming soon')">üéØ Quests</button>
    <button class="tab-button" onclick="alert('Leaderboard coming soon')">üèÜ Leaderboard</button>
    <button class="tab-button" onclick="alert('Shop coming soon')">üõí Shop</button>
    <button class="tab-button" onclick="alert('Profile coming soon')">üë§ Profile</button>
  </div>

  <script>
    const dbUrl = 'https://tralalero-fec07-default-rtdb.firebaseio.com';
    let userId = null;
    let balance = 0;
    const tapImage = document.getElementById('tapImage');
    const tokenCount = document.getElementById('tokenCount');

    function updateBalanceDisplay() {
      tokenCount.textContent = `${balance} tokens`;
    }

    function handleTap() {
      balance++;
      updateBalanceDisplay();
      tapImage.classList.add("tap-animation");
      showFloatingText('+1');
      setTimeout(() => tapImage.classList.remove("tap-animation"), 200);
      saveProgress();
    }

    function showFloatingText(text) {
      const floatText = document.createElement("div");
      floatText.className = "floating-text";
      floatText.textContent = text;
      const rect = tapImage.getBoundingClientRect();
      floatText.style.left = rect.left + rect.width / 2 + "px";
      floatText.style.top = rect.top + rect.height / 2 + "px";
      document.body.appendChild(floatText);
      setTimeout(() => floatText.remove(), 1000);
    }

    function saveProgress() {
      if (!userId) return;
      const user = Telegram.WebApp.initDataUnsafe?.user || {};
      const userData = {
        balance,
        first_name: user.first_name || "",
        last_name: user.last_name || "",
        username: user.username || "",
        photo_url: user.photo_url || ""
      };
      fetch(`${dbUrl}/users/${userId}.json`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData)
      });
    }

    function loadProgress() {
      if (!userId) return;
      fetch(`${dbUrl}/users/${userId}.json`)
        .then(res => res.json())
        .then(data => {
          if (data) {
            balance = data.balance || 0;
            updateBalanceDisplay();
          }
        });
    }

    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('gameContainer').style.display = 'flex';
      }, 5000);

      if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        userId = Telegram.WebApp.initDataUnsafe?.user?.id?.toString();
        if (userId) {
          loadProgress();
        } else {
          alert("Failed to get userId from Telegram WebApp.");
        }
      }
    });
<script>
function toggleTab(tabId) {
  const containers = ['gameContainer', 'shopContainer', 'boosterContainer'];
  containers.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });
  const target = document.getElementById(tabId);
  if (target) target.style.display = 'flex';
}
</script>

<div class="tab-bar">
  <button class="tab-button" onclick="toggleTab('gameContainer')">ü¶à Game</button>
  <button class="tab-button" onclick="toggleTab('boosterContainer')">‚ö° Boosters</button>
  <button class="tab-button" onclick="toggleTab('shopContainer')">üõí Shop</button>
</div>

<!-- üõç SHOP + BOOSTERS MODULE -->
<div id="shopContainer" style="display: none; padding: 20px; flex-direction: column; align-items: center;">
  <h2 style="font-size: 22px; font-weight: 700; margin-bottom: 16px;">Shark Skins</h2>
  <div style="display: flex; flex-direction: column; gap: 12px;">
    <div class="shop-item">
      <img src="shark.png" style="width: 100px; border-radius: 16px;">
      <button onclick="buySkin('default', 0)">Use</button>
    </div>
    <div class="shop-item">
      <img src="shark_skin1.png" style="width: 100px; border-radius: 16px;">
      <button onclick="buySkin('gold', 1000)">Buy / Use (1000)</button>
    </div>
    <div class="shop-item">
      <img src="shark_skin2.png" style="width: 100px; border-radius: 16px;">
      <button onclick="buySkin('leopard', 500)">Buy / Use (500)</button>
    </div>
  </div>
</div>

<div id="boosterContainer" style="display: none; padding: 20px; flex-direction: column; align-items: center;">
  <h2 style="font-size: 22px; font-weight: 700; margin-bottom: 16px;">Boosters</h2>
  <div style="display: flex; flex-direction: column; gap: 12px;">
    <div class="booster-item">
      <div>Auto-Tap +1 (50 tokens)</div>
      <button onclick="buyBooster(50, 1)">Buy</button>
    </div>
    <div class="booster-item">
      <div>Auto-Tap +2 (100 tokens)</div>
      <button onclick="buyBooster(100, 2)">Buy</button>
    </div>
    <div class="booster-item">
      <div>Auto-Tap +3 (1000 tokens)</div>
      <button onclick="buyBooster(1000, 3)">Buy</button>
    </div>
  </div>
</div>

<script>
let ownedSkins = { default: true };
let currentSkin = 'default';
let autoTap = 0;

function buySkin(skin, cost) {
  if (ownedSkins[skin] || balance >= cost) {
    if (!ownedSkins[skin]) {
      balance -= cost;
      ownedSkins[skin] = true;
    }
    currentSkin = skin;
    document.getElementById('tapImage').src = skin === 'gold' ? 'shark_skin1.png' : skin === 'leopard' ? 'shark_skin2.png' : 'shark.png';
    updateBalanceDisplay();
    saveProgress();
  } else {
    alert('Not enough tokens!');
  }
}

function buyBooster(cost, power) {
  if (balance >= cost) {
    balance -= cost;
    autoTap += power;
    updateBalanceDisplay();
    saveProgress();
  } else {
    alert('Not enough tokens!');
  }
}

setInterval(() => {
  if (autoTap > 0) {
    balance += autoTap;
    updateBalanceDisplay();
    saveProgress();
  }
}, 1000);
</script>

<!-- üëÜ Tabs + Cards HoYoLAB + Full Switching Logic Done -->
</body>
</html>
