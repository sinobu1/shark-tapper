<!--
  Shark Tapper: –≤–µ—Ä—Å–∏—è —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
  üîπ –°—Ç–∏–ª—å: iOS / Telegram Web App
  üîπ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram, Firebase, –∑–∞–≥—Ä—É–∑–∫–∏, —Å–∫–∏–Ω–æ–≤, –±—É—Å—Ç–µ—Ä–æ–≤, –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
-->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Shark Tapper</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #f2f2f7;
      --card-bg: #ffffff;
      --accent: #007aff;
      --text: #1c1c1e;
      --border: #d1d1d6;
    }
    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
    }
    body, html {
      height: 100%;
      background: var(--bg);
      color: var(--text);
    }
    .app { max-width: 420px; margin: 0 auto; padding-bottom: 80px; }
    .header { text-align: center; padding: 16px; font-weight: 700; font-size: 20px; color: var(--accent); }
    .card { background: var(--card-bg); border-radius: 20px; margin: 16px; padding: 16px; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
    .btn { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s; }
    .btn:active { opacity: 0.85; transform: scale(0.97); }
    .xp-bar-container { width: 100%; background: #e0e0e0; border-radius: 10px; height: 8px; margin-top: 8px; overflow: hidden; }
    .xp-bar { height: 100%; background: linear-gradient(90deg, #34c759, #30d158); width: 0%; transition: width 0.3s ease-in-out; }
    .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; justify-content: space-around; background: white; border-top: 1px solid var(--border); padding: 10px 0; z-index: 10; }
    .bottom-nav button { background: none; border: none; font-size: 18px; color: var(--accent); cursor: pointer; }
    @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-20px); opacity: 0; } }
    .floating-text { position: absolute; font-size: 18px; font-weight: bold; color: #30d158; animation: floatUp 0.8s ease forwards; pointer-events: none; }
    .loading-screen { position: fixed; width: 100%; height: 100%; background: #fff; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #00ffcc, #0072ff); animation: loadProgress 5s linear forwards; box-shadow: 0 0 12px #00f5ff; }
    @keyframes loadProgress { 0% { width: 0%; } 100% { width: 100%; } }
  </style>
</head>
<body>
  <div class="loading-screen" id="loading">
    <img src="w1.png" style="position:absolute; width:100%; height:100%; object-fit:cover; z-index:-1;" />
    <div style="position:absolute; bottom:80px; width:100%; text-align:center;">
      <div style="font-family: 'Inter', sans-serif; font-size: 24px; color: #fff; text-shadow: 2px 2px 8px rgba(0,0,0,0.8); margin-bottom: 16px;">
        –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –≥–æ–¥–∞ 2025
      </div>
      <div style="width: 80%; height: 14px; background: #1a1a1a; border-radius: 8px; overflow: hidden; margin: 0 auto;">
        <div id="progress-bar"></div>
      </div>
    </div>
  </div>
  <div class="app" id="game" style="display:none">
    <div class="header">Shark Tapper</div>
    <div class="card" id="gameCard">
      <div><strong id="levelText">–£—Ä–æ–≤–µ–Ω—å 1</strong></div>
      <div class="xp-bar-container"><div class="xp-bar" id="xpBar"></div></div>
      <div style="margin: 16px 0; font-size: 18px;"><span id="balance">0</span> ü™ô —Ç–æ–∫–µ–Ω–æ–≤</div>
      <img id="tapImage" src="shark.png?v=1" style="width: 100%; border-radius: 12px; cursor: pointer;" onclick="handleTap()"/>
      <div style="margin-top: 16px;"><button class="btn" onclick="openShop()">–ú–∞–≥–∞–∑–∏–Ω</button></div>
      <div style="margin-top: 12px;"><button class="btn" onclick="openBoosters()">–ë—É—Å—Ç–µ—Ä—ã</button></div>
    </div>
  </div>
  <div class="bottom-nav">
    <button onclick="openLeaderboard()">üèÜ</button>
    <button onclick="Telegram.WebApp.close()">üö™</button>
  </div>

  <script>
    const dbUrl = 'https://tralalero-fec07-default-rtdb.firebaseio.com';
    let currentSkin = 'default';
    let balance = 0;
    let xp = 0;
    let level = 1;
    let autoTap = 0;
    let ownedSkins = { default: true };
    let ownedBoosters = { 1: false, 2: false, 3: false };
    let userId = null;

    function xpToNext() { return 20 + (level - 1) * 10; }

    function updateXP() {
      let need = xpToNext();
      if (xp >= need) {
        xp -= need;
        level++;
        document.getElementById('levelText').textContent = '–£—Ä–æ–≤–µ–Ω—å ' + level;
      }
      const percent = Math.floor((xp / xpToNext()) * 100);
      document.getElementById('xpBar').style.width = percent + '%';
    }

    function handleTap() {
      balance++;
      xp++;
      updateBalance();
      updateXP();
      showFloatingText('+1');
      saveProgress();
    }

    function updateBalance() {
      document.getElementById('balance').textContent = balance;
    }

    function showFloatingText(text) {
      const el = document.createElement('div');
      el.className = 'floating-text';
      el.innerText = text;
      document.body.appendChild(el);
      const img = document.getElementById('tapImage');
      const rect = img.getBoundingClientRect();
      el.style.left = rect.left + rect.width / 2 + 'px';
      el.style.top = rect.top + 'px';
      setTimeout(() => el.remove(), 800);
    }

    function openShop() { alert('–ú–∞–≥–∞–∑–∏–Ω –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–∑–∂–µ'); }
    function openBoosters() { alert('–ë—É—Å—Ç–µ—Ä—ã —Å–∫–æ—Ä–æ –±—É–¥—É—Ç'); }
    function openLeaderboard() { alert('–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è'); }

    function saveProgress() {
      if (!userId) return;
      const user = Telegram.WebApp.initDataUnsafe?.user || {};
      const userData = {
        balance, currentSkin, ownedSkins, autoTap, ownedBoosters,
        first_name: user.first_name || "", last_name: user.last_name || "",
        username: user.username || "", photo_url: user.photo_url || ""
      };
      fetch(`${dbUrl}/users/${userId}.json`, {
        method: 'PUT', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData)
      });
    }

    function loadProgress() {
      if (!userId) return;
      fetch(`${dbUrl}/users/${userId}.json`)
        .then(res => res.json())
        .then(data => {
          if (data) {
            balance = data.balance || 0;
            currentSkin = data.currentSkin || 'default';
            ownedSkins = data.ownedSkins || { default: true };
            autoTap = data.autoTap || 0;
            ownedBoosters = data.ownedBoosters || { 1: false, 2: false, 3: false };
            updateBalance();
          }
        });
    }

    function startAutoTap() {
      setInterval(() => {
        if (autoTap > 0) {
          balance += autoTap;
          updateBalance();
          saveProgress();
        }
      }, 1000);
    }

    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('game').style.display = 'block';
      }, 5000);

      if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        userId = Telegram.WebApp.initDataUnsafe?.user?.id?.toString();
        if (userId) {
          loadProgress();
          startAutoTap();
        } else {
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å userId –∏–∑ Telegram Web App.");
        }
      }
    });
  </script>
</body>
</html>
