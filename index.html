<!--
  Tralalero Combat ‚Äî –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
  üîπ –ü–æ–ª–Ω—ã–π index.html —Å: –∏–≥—Ä–∞, –º–∞–≥–∞–∑–∏–Ω, –±—É—Å—Ç–µ—Ä—ã, –ª–∏–¥–µ—Ä–±–æ—Ä–¥, –ø—Ä–æ—Ñ–∏–ª—å
  üîπ –°—Ç–∏–ª—å: iOS / App Store / Telegram Web App
  üîπ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
-->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Tralalero Combat</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #f2f2f7;
      --card-bg: #ffffff;
      --accent: #ffb300;
      --text: #1c1c1e;
      --border: #d1d1d6;
      --gold: #ffcc00;
    }
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
    html, body { height: 100%; background: var(--bg); color: var(--text); overflow-x: hidden; }
    .app { max-width: 420px; margin: 0 auto; padding-bottom: 90px; }
    .header { text-align: center; padding: 16px; font-weight: 700; font-size: 22px; color: var(--accent); text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .balance { font-size: 20px; font-weight: 600; margin: 12px auto; color: var(--gold); text-align: center; }
    .tap-button {
      width: 160px; height: 160px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffd700, #ffb300);
      border: 4px solid #fff2cc;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      margin: 0 auto;
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.1s ease-in-out; cursor: pointer;
    }
    .tap-button:active { transform: scale(0.95); }
    .tap-button img { width: 100px; height: 100px; pointer-events: none; }
    .xp-bar-container {
      width: 90%; background: #e0e0e0; border-radius: 10px;
      height: 10px; margin: 10px auto; overflow: hidden;
    }
    .xp-bar {
      height: 100%; background: linear-gradient(90deg, #34c759, #30d158);
      width: 0%; transition: width 0.3s ease-in-out;
    }
    .floating-text {
      position: absolute; font-size: 22px; font-weight: bold; color: var(--gold);
      animation: floatUp 0.8s ease forwards; pointer-events: none;
      text-shadow: 0 0 4px rgba(0,0,0,0.2);
    }
    @keyframes floatUp {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-30px); opacity: 0; }
    }
    .tab-content { display: none; padding: 16px; }
    .tab-content.active { display: block; }
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; width: 100%; display: flex;
      justify-content: space-around; background: white;
      border-top: 1px solid var(--border); padding: 10px 0; z-index: 10;
    }
    .bottom-nav button {
      background: none; border: none; font-size: 18px;
      color: var(--accent); cursor: pointer;
    }
    h2 { text-align: center; color: var(--accent); margin-bottom: 12px; }
    .shop-item, .booster-item {
      text-align: center; margin: 10px auto;
    }
    .shop-item img { width: 100px; height: auto; border-radius: 12px; }
    .shop-item button, .booster-item button {
      margin-top: 8px; padding: 6px 12px; font-size: 15px;
      border: none; border-radius: 8px; background: var(--accent);
      color: white; cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">Tralalero Combat</div>

    <div id="tab-game" class="tab-content active">
      <div style="text-align:center;"><strong id="levelText">–£—Ä–æ–≤–µ–Ω—å 1</strong></div>
      <div class="xp-bar-container"><div class="xp-bar" id="xpBar"></div></div>
      <div class="balance"><span id="balance">0</span> ü™ô</div>
      <div class="tap-button" onclick="handleTap()">
        <img src="coin.png" alt="–ú–æ–Ω–µ—Ç–∫–∞" id="tapImage" />
      </div>
    </div>

    <div id="tab-shop" class="tab-content">
      <h2>–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</h2>
      <div class="shop-item">
        <img src="shark.png?v=1" />
        <button onclick="buySkin('default', 0)">–í—ã–±—Ä–∞—Ç—å</button>
      </div>
      <div class="shop-item">
        <img src="shark_skin1.png?v=1" />
        <button onclick="buySkin('skin1', 500)">–ö—É–ø–∏—Ç—å –∑–∞ 500</button>
      </div>
    </div>

    <div id="tab-boosters" class="tab-content">
      <h2>–ë—É—Å—Ç–µ—Ä—ã</h2>
      <div class="booster-item">
        <div>+1 –∞–≤—Ç–æ-—Ç–∞–ø (50 ü™ô)</div>
        <button onclick="buyBooster(50, 1)">–ö—É–ø–∏—Ç—å</button>
      </div>
      <div class="booster-item">
        <div>+2 –∞–≤—Ç–æ-—Ç–∞–ø (150 ü™ô)</div>
        <button onclick="buyBooster(150, 2)">–ö—É–ø–∏—Ç—å</button>
      </div>
    </div>

    <div id="tab-leaderboard" class="tab-content">
      <h2>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
      <ul id="leaderboard"></ul>
    </div>

    <div id="tab-profile" class="tab-content">
      <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
      <div id="profileInfo">Telegram –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div>
    </div>
  </div>
  <div class="bottom-nav">
    <button onclick="switchTab('game')">üéÆ</button>
    <button onclick="switchTab('shop')">üõçÔ∏è</button>
    <button onclick="switchTab('boosters')">‚ö°</button>
    <button onclick="switchTab('leaderboard')">üèÜ</button>
    <button onclick="switchTab('profile')">üë§</button>
  </div>

  <script>
    let userId = null;
    let balance = 0;
    let xp = 0;
    let level = 1;
    let autoTap = 0;
    let ownedSkins = { default: true };
    let ownedBoosters = {};
    const dbUrl = 'https://tralalero-fec07-default-rtdb.firebaseio.com';

    function xpToNext() { return 20 + (level - 1) * 10; }
    function updateXP() {
      if (xp >= xpToNext()) {
        xp -= xpToNext(); level++;
        document.getElementById('levelText').textContent = '–£—Ä–æ–≤–µ–Ω—å ' + level;
      }
      document.getElementById('xpBar').style.width = Math.floor((xp / xpToNext()) * 100) + '%';
    }
    function updateBalance() { document.getElementById('balance').textContent = balance; }

    function handleTap() {
      balance++; xp++;
      updateBalance(); updateXP();
      showFloatingText('+1');
      if (navigator.vibrate) navigator.vibrate(30);
      saveProgress();
    }

    function showFloatingText(text) {
      const el = document.createElement('div');
      el.className = 'floating-text';
      el.innerText = text;
      const rect = document.getElementById('tapImage').getBoundingClientRect();
      el.style.left = rect.left + rect.width / 2 + 'px';
      el.style.top = rect.top + 'px';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 800);
    }

    function switchTab(name) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.getElementById('tab-' + name).classList.add('active');
      if (name === 'leaderboard') loadLeaderboard();
    }

    function buySkin(skinId, price) {
      if (ownedSkins[skinId]) return;
      if (balance >= price) {
        balance -= price; ownedSkins[skinId] = true;
        updateBalance(); saveProgress();
        alert('–°–∫–∏–Ω –∫—É–ø–ª–µ–Ω!');
      } else alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
    }

    function buyBooster(price, power) {
      if (ownedBoosters[power]) return alert('–£–∂–µ –∫—É–ø–ª–µ–Ω–æ!');
      if (balance >= price) {
        balance -= price;
        autoTap += power;
        ownedBoosters[power] = true;
        updateBalance(); saveProgress();
      } else alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');
    }

    function startAutoTap() {
      setInterval(() => {
        if (autoTap > 0) {
          balance += autoTap;
          updateBalance();
          saveProgress();
        }
      }, 1000);
    }

    function saveProgress() {
      if (!userId) return;
      fetch(`${dbUrl}/users/${userId}.json`, {
        method: 'PUT', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ balance, xp, level, autoTap, ownedSkins, ownedBoosters })
      });
    }

    function loadProgress() {
      fetch(`${dbUrl}/users/${userId}.json`)
        .then(res => res.json())
        .then(data => {
          if (!data) return;
          balance = data.balance || 0;
          xp = data.xp || 0;
          level = data.level || 1;
          autoTap = data.autoTap || 0;
          ownedSkins = data.ownedSkins || { default: true };
          ownedBoosters = data.ownedBoosters || {};
          updateBalance(); updateXP();
        });
    }

    function loadLeaderboard() {
      fetch(`${dbUrl}/users.json`).then(r => r.json()).then(data => {
        const list = Object.entries(data || {}).sort((a,b)=>b[1].balance-a[1].balance).slice(0, 10);
        const el = document.getElementById('leaderboard');
        el.innerHTML = '';
        list.forEach(([id, user]) => {
          const li = document.createElement('li');
          li.textContent = `${user.first_name || '–ò–≥—Ä–æ–∫'}: ${user.balance} ü™ô`;
          el.appendChild(li);
        });
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      if (Telegram.WebApp) {
        Telegram.WebApp.ready(); Telegram.WebApp.expand();
        const user = Telegram.WebApp.initDataUnsafe?.user;
        if (!user) return alert("Telegram WebApp user –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
        userId = user.id;
        document.getElementById('profileInfo').innerHTML = `üë§ ${user.first_name}<br/>@${user.username}`;
        loadProgress(); startAutoTap();
      }
    });
  </script>
</body>
</html>
