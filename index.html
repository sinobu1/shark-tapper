<style>
  :root {
    --color-bg-light: #f0f4f8;
    --color-bg-dark: #1e1e1e;
    --color-text-light: #222;
    --color-text-dark: #eee;
    --color-accent: #00bfa5;
    --color-accent-dark: #009e85;
  }

  body.light-theme {
    background-color: var(--color-bg-light);
    color: var(--color-text-light);
  }

  body.dark-theme {
    background-color: var(--color-bg-dark);
    color: var(--color-text-dark);
  }

  :root {
    --color-bg-light: #f0f4f8;
    --color-bg-dark: #1e1e1e;
    --color-text-light: #222;
    --color-text-dark: #eee;
    --color-accent: #00bfa5;
    --color-accent-dark: #009e85;
  }

  body.light-theme {
    background-color: var(--color-bg-light);
    color: var(--color-text-light);
  }

  body.dark-theme {
    background-color: var(--color-bg-dark);
    color: var(--color-text-dark);
  }

  .tab-panel {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    background-color: var(--color-accent);
    padding: 8px 0;
    gap: 4px;
    z-index: 100;
  }

  .tab-button {
    flex: 1;
    padding: 10px 0;
    font-size: 14px;
    border: none;
    background: var(--color-accent);
    color: white;
    font-weight: 600;
    transition: background 0.2s;
  }

  .tab-button:hover {
    background: var(--color-accent-dark);
  }

  .tab-button:active {
    transform: scale(0.98);
  }

  .theme-toggle {
    position: fixed;
    top: 10px;
    right: 10px;
    background: var(--color-accent);
    color: white;
    padding: 6px 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    z-index: 200;
  }
</style>

<button class="theme-toggle" onclick="toggleTheme()">üåó –¢–µ–º–∞</button>

<button class="theme-toggle" onclick="toggleTheme()">üåó –¢–µ–º–∞</button>
<div class="tab-panel">
  <button class="tab-button" onclick="toggleTab('gameContainer')">ü¶à –ò–≥—Ä–∞</button>
  <button class="tab-button" onclick="toggleTab('boosterContainer')">‚ö° –ë—É—Å—Ç–µ—Ä—ã</button>
  <button class="tab-button" onclick="toggleTab('shopContainer')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
  <button class="tab-button" onclick="toggleTab('profileContainer')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  <button class="tab-button" onclick="openLeaderboard()">üèÜ –¢–æ–ø</button>
</div>

<div id="gameContainer" class="game-container">
  <img id="tapImage" class="tap-image" src="shark.png" alt="Shark" onclick="handleTap()" />
</div>

<div id="boosterContainer" class="game-container">
  <h2>–ë—É—Å—Ç–µ—Ä—ã</h2>
  <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –±—É—Å—Ç–µ—Ä—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–æ–±—ã—á–∏ —Ç–æ–∫–µ–Ω–æ–≤.</p>
</div>

<div id="shopContainer" class="game-container">
  <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
  <p>–ö—É–ø–∏—Ç–µ —Å–∫–∏–Ω—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –∞–∫—É–ª—ã.</p>
</div>

<div id="profileContainer" class="game-container">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
  <img id="profileAvatar" src="" alt="avatar" style="width:72px;height:72px;border-radius:50%;margin:10px 0;" />
  <h3 id="profileName">–ò–≥—Ä–æ–∫</h3>
  <p id="profileTokens">–¢–æ–∫–µ–Ω–æ–≤: 0</p>
  <p id="profileLevel">–£—Ä–æ–≤–µ–Ω—å: 1</p>
  <p id="profileJoin">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ‚Äî</p>
</div>

<div id="leaderboard-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.95);z-index:1000;flex-direction:column;align-items:center;justify-content:center;">
  <h2>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
  <ul id="leaderboardList"></ul>
  <button onclick="document.getElementById('leaderboard-modal').style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<script>
function openLeaderboard() {
  document.getElementById('leaderboard-modal').style.display = 'flex';
  fetch("https://tralalero-fec07-default-rtdb.firebaseio.com/users.json")
    .then(res => res.json())
    .then(data => {
      const leaderboard = document.getElementById('leaderboardList');
      leaderboard.innerHTML = '';
      const users = Object.entries(data || {}).map(([id, info]) => ({ id, ...info }))
        .sort((a, b) => b.balance - a.balance).slice(0, 10);
      users.forEach(user => {
        const name = user.first_name || `ID ${user.id.slice(-4)}`;
        const avatar = user.photo_url ? `<img src="${user.photo_url}" style="width:20px;height:20px;border-radius:50%;margin-right:6px;" />` : '';
        const li = document.createElement('li');
        li.innerHTML = `${avatar}<strong>${name}</strong>: ${user.balance}`;
        leaderboard.appendChild(li);
      });
    });
}

function toggleTheme() {
  const body = document.body;
  if (body.classList.contains('dark-theme')) {
    body.classList.replace('dark-theme', 'light-theme');
    localStorage.setItem('theme', 'light');
  } else {
    body.classList.replace('light-theme', 'dark-theme');
    localStorage.setItem('theme', 'dark');
  }
} else {
    body.classList.remove('light-theme');
    body.classList.add('dark-theme');
  }
}

function saveActiveTab(id) {
  localStorage.setItem('activeTab', id);
}

function toggleTab(id) {
  ['gameContainer', 'shopContainer', 'boosterContainer', 'profileContainer'].forEach(el => {
    const element = document.getElementById(el);
    if (element) element.style.display = 'none';
  });
  const selected = document.getElementById(id);
  if (selected) selected.style.display = 'flex';
  saveActiveTab(id);
}

function toggleTheme() {
  const body = document.body;
  const themeBtn = document.querySelector('.theme-toggle');
  if (body.classList.contains('dark-theme')) {
    body.classList.replace('dark-theme', 'light-theme');
    localStorage.setItem('theme', 'light');
    themeBtn.textContent = 'üåô –¢–µ–º–∞';
  } else {
    body.classList.replace('light-theme', 'dark-theme');
    localStorage.setItem('theme', 'dark');
    themeBtn.textContent = '‚òÄÔ∏è –¢–µ–º–∞';
  }
}

window.onload = () => {
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.body.classList.add(`${savedTheme}-theme`);
  document.querySelector('.theme-toggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è –¢–µ–º–∞' : 'üåô –¢–µ–º–∞';

  const lastTab = localStorage.getItem('activeTab') || 'gameContainer';
  toggleTab(lastTab);

  if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
    const user = Telegram.WebApp.initDataUnsafe?.user || {};
    userId = user?.id?.toString();
    userFirstName = user?.first_name || '–ò–≥—Ä–æ–∫';
    userAvatar = user?.photo_url || '';
    joinDate = new Date().toISOString().split('T')[0];
    if (userId) loadProgress();
  }
};
function toggleTheme() {
  const body = document.body;
  if (body.classList.contains('dark-theme')) {
    body.classList.replace('dark-theme', 'light-theme');
    localStorage.setItem('theme', 'light');
  } else {
    body.classList.replace('light-theme', 'dark-theme');
    localStorage.setItem('theme', 'dark');
  }
}

function saveActiveTab(id) {
  localStorage.setItem('activeTab', id);
}

function toggleTab(id) {
  ['gameContainer', 'shopContainer', 'boosterContainer', 'profileContainer'].forEach(el => {
    const element = document.getElementById(el);
    if (element) element.style.display = 'none';
  });
  const selected = document.getElementById(id);
  if (selected) selected.style.display = 'flex';
  saveActiveTab(id);
}

window.onload = () => {
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.body.classList.add(`${savedTheme}-theme`);

  const lastTab = localStorage.getItem('activeTab') || 'gameContainer';
  toggleTab(lastTab);

  if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
    const user = Telegram.WebApp.initDataUnsafe?.user || {};
    userId = user?.id?.toString();
    userFirstName = user?.first_name || '–ò–≥—Ä–æ–∫';
    userAvatar = user?.photo_url || '';
    joinDate = new Date().toISOString().split('T')[0];
    if (userId) loadProgress();
  }
};
</script>
