<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shop</title>
  <style>
    :root {
      --primary: #2f80ed;
      --accent: #56ccf2;
      --bg: #f2f5f9;
      --card-bg: #ffffff;
      --text: #0d1b2a;
      --subtext: #6c7787;
      --border: #e0e6ed;
    }
    .shop-item {
      background: var(--card-bg);
      border-radius: 1rem;
      padding: 1rem;
      margin: 0.5rem;
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: all 0.2s ease;
    }
    .shop-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .shop-item img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      margin-bottom: 0.5rem;
    }
    .shop-item button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.7rem;
      margin-top: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .shop-item button:disabled {
      background: var(--subtext);
      cursor: not-allowed;
    }
    .shop-item button:hover:not(:disabled) {
      background: var(--accent);
      transform: scale(1.05);
    }
    .coin-popup {
      position: absolute;
      font-family: 'Press Start 2P', cursive;
      color: #f8d030;
      text-shadow: 1px 1px 0 #b88b00, -1px -1px 0 #b88b00;
      font-size: 0.9rem;
      animation: coinPopup 1s forwards;
      pointer-events: none;
      z-index: 20;
      white-space: nowrap;
    }
    @keyframes coinPopup {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-50px); opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="tab-page" id="shop">
    <div style="padding: 1rem;">
      <h2 style="font-family: 'Rubik Mono One', sans-serif; margin-bottom: 1rem; text-align: center;">üõç SHARK SHOP</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.5rem;" id="shopItems">
        <div class="shop-item">
          <img src="https://sinobu1.github.io/shark-tapper/shark_skin1.png" alt="Gold Shark">
          <h3 style="font-size: 0.9rem; text-align: center;">Gold Shark</h3>
          <p style="color: var(--subtext); font-size: 0.7rem; text-align: center;">500 coins</p>
          <button data-item="skin3" data-cost="500">Buy</button>
        </div>
        <div class="shop-item">
          <img src="https://sinobu1.github.io/shark-tapper/shark_skin2.png" alt="Leopard Shark">
          <h3 style="font-size: 0.9rem; text-align: center;">Leopard Shark</h3>
          <p style="color: var(--subtext); font-size: 0.7rem; text-align: center;">300 coins</p>
          <button data-item="skin2" data-cost="300">Buy</button>
        </div>
        <div class="shop-item">
          <img src="https://sinobu1.github.io/shark-tapper/autoclicker.png" alt="Autoclicker">
          <h3 style="font-size: 0.9rem; text-align: center;">Autoclicker</h3>
          <p style="color: var(--subtext); font-size: 0.7rem; text-align: center;">1000 coins</p>
          <button data-item="autoclicker" data-cost="1000">Buy</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let userData = {};

  document.addEventListener("DOMContentLoaded", function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
    try {
      const tgUser = Telegram.WebApp.initDataUnsafe?.user;
      if (tgUser) {
        userData.userId = tgUser.id;
      }
    } catch (e) {
      console.log('Telegram context not available');
    }

    loadFromFirebase();
  });

  async function loadFromFirebase() {
    if (!userData.userId) {
      loadFromLocalStorage();
      return;
    }
    
    try {
      const response = await fetch(`https://tralalero-fec07-default-rtdb.firebaseio.com/users/${userData.userId}.json`);
      const data = await response.json();
      
      if (data) {
        userData.tokens = data.balance || 0;
        userData.skin = data.skin || 'default';
        userData.autoclickers = data.autoclickers || 0;
        userData.achievements = data.achievements || [];
        
        setupShopButtons();
        saveToLocalStorage();
      }
    } catch(err) {
      console.error('Firebase load error:', err);
      loadFromLocalStorage();
    }
  }

  async function saveToFirebase() {
    if (!userData.userId) return;
    
    try {
      await fetch(`https://tralalero-fec07-default-rtdb.firebaseio.com/users/${userData.userId}.json`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          balance: userData.tokens,
          skin: userData.skin,
          autoclickers: userData.autoclickers,
          achievements: userData.achievements
        })
      });
    } catch(err) {
      console.error('Firebase save error:', err);
    }
  }
    let userData = {
      tokens: 0,
      skin: 'default',
      autoclickers: 0,
      achievements: []
    };
    
    document.addEventListener("DOMContentLoaded", function() {
      loadFromLocalStorage();
      setupShopButtons();
    });
    
    function loadFromLocalStorage() {
      const savedData = localStorage.getItem('sharkTapperData');
      if (savedData) {
        try {
          const parsed = JSON.parse(savedData);
          userData.tokens = parsed.tokens || 0;
          userData.skin = parsed.skin || 'default';
          userData.autoclickers = parsed.autoclickers || 0;
          userData.achievements = parsed.achievements || [];
        } catch(e) {
          console.error('Error parsing saved data', e);
        }
      }
    }
    
    function setupShopButtons() {
      document.querySelectorAll('#shopItems button').forEach(btn => {
        const item = btn.dataset.item;
        const cost = parseInt(btn.dataset.cost);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫—É–ø–ª–µ–Ω –ª–∏ —É–∂–µ –ø—Ä–µ–¥–º–µ—Ç
        if ((item.startsWith('skin') && userData.achievements.includes(item)) || 
            (item === 'autoclicker' && userData.autoclickers > 0)) {
          btn.textContent = 'Owned';
          btn.disabled = true;
        }
        
        btn.addEventListener('click', function() {
          buyItem(item, cost);
        });
      });
    }
    
    function buyItem(item, cost) {
      if (userData.tokens < cost) {
        showPopup('Not enough coins!', '#e74c3c');
        return;
      }
      
      userData.tokens -= cost;
      
      if (item.startsWith('skin')) {
        userData.achievements.push(item);
        showPopup('Skin unlocked!', '#56ccf2');
      } else if (item === 'autoclicker') {
        userData.autoclickers += 1;
        showPopup('Autoclicker +1!', '#f39c12');
      }
      
      saveToLocalStorage();
      setupShopButtons(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
    }
    
    function showPopup(text, color) {
      const popup = document.createElement('div');
      popup.className = 'coin-popup';
      popup.textContent = text;
      popup.style.left = '50%';
      popup.style.top = '40%';
      popup.style.color = color;
      document.body.appendChild(popup);
      setTimeout(() => popup.remove(), 1000);
    }
    
    function saveToLocalStorage() {
      const savedData = JSON.parse(localStorage.getItem('sharkTapperData') || '{}');
      savedData.tokens = userData.tokens;
      savedData.skin = userData.skin;
      savedData.autoclickers = userData.autoclickers;
      savedData.achievements = userData.achievements;
      localStorage.setItem('sharkTapperData', JSON.stringify(savedData));
    }
  </script>
</body>
</html>
